<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Management System</title>
<style>
/* ===============================
   AURORA FLOW THEME
================================ */

:root {
  --primary: #3f51b5;        /* Indigo */
  --primary-dark: #2c387e;
  --secondary: #00acc1;      /* Cyan */
  --accent: #ff9800;         /* Orange */
  --danger: #e53935;
  --bg-main: #f4f6fb;
  --card-bg: #ffffff;
  --border: #e0e3eb;
  --text-main: #2b2f3a;
  --text-muted: #6b7280;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: "Inter", "Segoe UI", sans-serif;
  background: radial-gradient(circle at top,
    #e8eaf6,
    #f4f6fb 60%);
  color: var(--text-main);
  padding: 20px;
  animation: pageFade 0.6s ease-out;
}

.container {
  max-width: 1200px;
  margin: auto;
}

/* ===============================
   HEADINGS
================================ */
h1 {
  text-align: center;
  margin-bottom: 28px;
  font-size: 2.1rem;
  letter-spacing: 0.5px;
  color: var(--primary-dark);
}
/*marks button

<script>
let marksChart;

/* Create / Update Chart */
function renderMarksChart(students) {
  const ctx = document.getElementById('marksChart');
  if (!ctx) return;

  const names = students.map(s => s.student_name);

  const tamil = students.map(s => s.tamil || 0);
  const english = students.map(s => s.english || 0);
  const maths = students.map(s => s.maths || 0);
  const science = students.map(s => s.science || 0);
  const social = students.map(s => s.social_science || 0);

  if (marksChart) {
    marksChart.destroy();
  }

  marksChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: names,
      datasets: [
        {
          label: 'Tamil',
          data: tamil,
          backgroundColor: '#5c6bc0'
        },
        {
          label: 'English',
          data: english,
          backgroundColor: '#26c6da'
        },
        {
          label: 'Maths',
          data: maths,
          backgroundColor: '#66bb6a'
        },
        {
          label: 'Science',
          data: science,
          backgroundColor: '#ffa726'
        },
        {
          label: 'Social',
          data: social,
          backgroundColor: '#ef5350'
        }
      ]
    },
    options: {
      responsive: true,
      animation: {
        duration: 1400,
        easing: 'easeOutQuart'
      },
      plugins: {
        legend: {
          position: 'top'
        },
        tooltip: {
          backgroundColor: '#2b2f3a',
          titleColor: '#fff',
          bodyColor: '#fff'
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          max: 100,
          grid: {
            color: '#e0e3eb'
          }
        },
        x: {
          grid: {
            display: false
          }
        }
      }
    }
  });
}
</script>

/*marks button//
/* ===============================
   TABS
================================ */
.tabs {
  display: flex;
  justify-content: center;
  gap: 14px;
  margin-bottom: 26px;
}

.tab {
  padding: 12px 26px;
  border-radius: 40px;
  background: var(--card-bg);
  border: 1px solid var(--border);
  cursor: pointer;
  font-weight: 600;
  color: var(--text-muted);
  transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.tab::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    120deg,
    transparent,
    rgba(63,81,181,0.12),
    transparent
  );
  transform: translateX(-100%);
  transition: transform 0.5s ease;
}

.tab:hover::after {
  transform: translateX(100%);
}

.tab:hover {
  transform: translateY(-2px);
  color: var(--primary);
}

.tab.active {
  background: linear-gradient(
    135deg,
    var(--primary),
    var(--secondary)
  );
  color: #fff;
  box-shadow: 0 14px 30px rgba(63,81,181,0.35);
}

/* ===============================
   TAB CONTENT ANIMATION
================================ */
.tab-content {
  display: none;
  animation: contentFlow 0.55s ease;
}

.tab-content.active {
  display: block;
}

/* ===============================
   CARDS
================================ */
.card {
  background: var(--card-bg);
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 24px;
  border: 1px solid var(--border);
  box-shadow:
    0 12px 25px rgba(0,0,0,0.05),
    0 3px 8px rgba(0,0,0,0.04);
  animation: cardRise 0.5s ease;
}

.card h2 {
  margin-bottom: 18px;
  font-size: 1.25rem;
  color: var(--primary-dark);
  position: relative;
}

.card h2::after {
  content: "";
  width: 40px;
  height: 3px;
  background: linear-gradient(
    to right,
    var(--secondary),
    var(--accent)
  );
  position: absolute;
  bottom: -6px;
  left: 0;
  border-radius: 5px;
}

/* ===============================
   FORM ELEMENTS
================================ */
label {
  font-weight: 600;
  margin-bottom: 6px;
  display: block;
  color: var(--text-muted);
}

input, select {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid var(--border);
  font-size: 14px;
  transition: all 0.25s ease;
}

input:focus, select:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(63,81,181,0.15);
  outline: none;
}

/* ===============================
   BUTTONS
================================ */
button {
  padding: 12px 18px;
  border-radius: 40px;
  border: none;
  font-weight: 600;
  letter-spacing: 0.5px;
  cursor: pointer;
  background: linear-gradient(
    135deg,
    var(--primary),
    var(--secondary)
  );
  color: white;
  transition:
    transform 0.25s ease,
    box-shadow 0.25s ease;
}

button:hover {
  transform: translateY(-3px);
  box-shadow: 0 14px 26px rgba(63,81,181,0.35);
}

button.secondary {
  background: linear-gradient(
    135deg,
    var(--secondary),
    #26c6da
  );
}

button.danger {
  background: linear-gradient(
    135deg,
    var(--danger),
    #ff7043
  );
}

/* ===============================
   TABLES
================================ */
table {
  width: 100%;
  border-collapse: collapse;
  overflow: hidden;
  border-radius: 14px;
}

th {
  background: linear-gradient(
    135deg,
    var(--primary),
    var(--primary-dark)
  );
  color: #fff;
  padding: 14px;
  font-size: 0.8rem;
  text-transform: uppercase;
}

td {
  padding: 13px;
  border-bottom: 1px solid var(--border);
  background: #fafbff;
  transition: background 0.2s ease;
}

tr:hover td {
  background: #eef1ff;
}

/* ===============================
   STATUS COLORS
================================ */
.status-present {
  color: #2e7d32;
  font-weight: 700;
}

.status-absent {
  color: #c62828;
  font-weight: 700;
}

/* ===============================
   LAYOUT
================================ */
.form-row {
  display: flex;
  gap: 16px;
  margin-bottom: 16px;
}

.form-row > div {
  flex: 1;
}

@media (max-width: 768px) {
  .form-row {
    flex-direction: column;
  }
}

/* ===============================
   REALISTIC ANIMATIONS
================================ */
@keyframes pageFade {
  from { opacity: 0 }
  to { opacity: 1 }
}

@keyframes cardRise {
  from {
    opacity: 0;
    transform: translateY(24px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes contentFlow {
  from {
    opacity: 0;
    transform: translateX(18px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}
</style>


</head>
<body>
  <div class="container">
    <h1>Student Management System</h1>
    
    <div class="tabs">
      <div class="tab active" onclick="showTab('students')">Students</div>
      <div class="tab" onclick="showTab('attendance')">Attendance</div>
      <div class="tab" onclick="showTab('exams')">Exam Schedule</div>
    </div>
    <!-- extra ading code-->
    
    <!-- Students Tab -->
    <div id="students" class="tab-content active">
      <div class="card">
        <h2>Add New Student</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="name">Full Name *</label>
            <input type="text" id="name" placeholder="Enter full name" required>
          </div>
          <div class="form-group">
            <label for="cls">Class *</label>
            <input type="number" id="cls" placeholder="Enter class" required>
          </div>
          <div class="form-group">
            <label for="sec">Section</label>
            <input type="text" id="sec" placeholder="Enter section">
          </div>
          <div class="form-group">
            <label for="gen">Gender</label>
            <select id="gen">
              <option value="">Select Gender</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
            </select>
          </div>
        </div>
        
        <h3>Marks</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="tamil">Tamil</label>
            <input type="number" id="tamil" placeholder="Tamil marks">
          </div>
          <div class="form-group">
            <label for="english">English</label>
            <input type="number" id="english" placeholder="English marks">
          </div>
          <div class="form-group">
            <label for="maths">Maths</label>
            <input type="number" id="maths" placeholder="Maths marks">
          </div>
          <div class="form-group">
            <label for="science">Science</label>
            <input type="number" id="science" placeholder="Science marks">
          </div>
          <div class="form-group">
            <label for="ss">Social Science</label>
            <input type="number" id="ss" placeholder="Social Science marks">
          </div>
        </div>
        
        <button onclick="saveStudent()" class="primary">Save Student</button>
      </div>
      
      <div class="card">
        <h2>Student List</h2>
        <div class="table-responsive">
          <table id="studentTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Class</th>
                <th>Section</th>
                <th>Gender</th>
                <th>Tamil</th>
                <th>English</th>
                <th>Maths</th>
                <th>Science</th>
                <th>Social</th>
              </tr>
            </thead>
            <tbody id="studentTableBody">
              <!-- Student data will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Attendance Tab -->
    <div id="attendance" class="tab-content">
      <div class="card">
        <h2>Mark Attendance</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="attendanceDate">Date</label>
            <input type="date" id="attendanceDate" required>
          </div>
          <div class="form-group">
            <label for="studentSelect">Student</label>
            <select id="studentSelect" required>
              <option value="">Select Student</option>
              <!-- Students will be loaded here -->
            </select>
          </div>
          <div class="form-group">
            <label for="attendanceStatus">Status</label>
            <select id="attendanceStatus" required>
              <option value="">Select Status</option>
              <option value="Present">Present</option>
              <option value="Absent">Absent</option>
            </select>
          </div>
        </div>
        <button onclick="saveAttendance()" class="secondary">Save Attendance</button>
      </div>
      
      <div class="card">
        <h2>Attendance Records</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="filterStudent">Filter by Student</label>
            <select id="filterStudent">
              <option value="">All Students</option>
              <!-- Students will be loaded here -->
            </select>
          </div>
          <div class="form-group">
            <label for="startDate">From Date</label>
            <input type="date" id="startDate">
          </div>
          <div class="form-group">
            <label for="endDate">To Date</label>
            <input type="date" id="endDate">
          </div>
          <div class="form-group" style="align-self: flex-end;">
            <button onclick="loadAttendance()" class="secondary">Filter</button>
          </div>
        </div>
        
        <div class="table-responsive">
          <table id="attendanceTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Student Name</th>
                <th>Class</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="attendanceTableBody">
              <!-- Attendance records will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Exam Schedule Tab -->
    <div id="exams" class="tab-content">
      <div class="card">
        <h2>Add Exam Schedule</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="examName">Exam Name *</label>
            <input type="text" id="examName" placeholder="e.g., Mid-Term, Final" required>
          </div>
          <div class="form-group">
            <label for="subject">Subject *</label>
            <input type="text" id="subject" placeholder="Enter subject" required>
          </div>
          <div class="form-group">
            <label for="examDate">Exam Date *</label>
            <input type="date" id="examDate" required>
          </div>
          <div class="form-group">
            <label for="examTime">Exam Time *</label>
            <input type="time" id="examTime" required>
          </div>
        </div>
        <button onclick="saveExam()" class="secondary">Save Exam</button>
      </div>
      
      <div class="card">
        <h2>Upcoming Exams</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="examStartDate">From Date</label>
            <input type="date" id="examStartDate">
          </div>
          <div class="form-group">
            <label for="examEndDate">To Date</label>
            <input type="date" id="examEndDate">
          </div>
          <div class="form-group" style="align-self: flex-end;">
            <button onclick="loadExams()" class="secondary">Filter</button>
          </div>
        </div>
        
        <div class="table-responsive">
          <table id="examTable">
            <thead>
              <tr>
                <th>Exam Name</th>
                <th>Subject</th>
                <th>Date</th>
                <th>Time</th>
              </tr>
            </thead>
            <tbody id="examTableBody">
              <!-- Exam schedule will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE_URL = 'http://localhost:3000';
    
    // Tab functionality
    function showTab(tabId) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Deactivate all tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show the selected tab content
      document.getElementById(tabId).classList.add('active');
      
      // Activate the clicked tab
      event.currentTarget.classList.add('active');
      
      // Load data when switching to a tab
      if (tabId === 'students') {
        loadStudents();
      } else if (tabId === 'attendance') {
        loadStudentsForAttendance();
        loadAttendance();
      } else if (tabId === 'exams') {
        loadExams();
      }
    }
    
    // Set default date to today for attendance and exam forms
    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('attendanceDate').value = today;
      document.getElementById('examDate').value = today;
      document.getElementById('examTime').value = '09:00';
      
      // Load initial data
      loadStudents();
    });
    
    // Format date to YYYY-MM-DD
    function formatDate(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      return date.toISOString().split('T')[0];
    }
    
    // Format time to HH:MM
    function formatTime(timeString) {
      if (!timeString) return '';
      const time = new Date(`2000-01-01T${timeString}`);
      return time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    
    // ====================
    // STUDENT FUNCTIONS
    // ====================
    
    // Load all students
    function loadStudents() {
      fetch(`${API_BASE_URL}/students`)
        .then(res => res.json())
        .then(students => {
          const tbody = document.getElementById('studentTableBody');
          tbody.innerHTML = '';
          
          if (students.length === 0) {
            tbody.innerHTML = '<tr><td colspan="9" style="text-align: center;">No students found</td></tr>';
            return;
          }
          
          students.forEach(student => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${student.student_name || '-'}</td>
              <td>${student.student_class || '-'}</td>
              <td>${student.section || '-'}</td>
              <td>${student.gender || '-'}</td>
              <td>${student.tamil !== null ? student.tamil : '-'}</td>
              <td>${student.english !== null ? student.english : '-'}</td>
              <td>${student.maths !== null ? student.maths : '-'}</td>
              <td>${student.science !== null ? student.science : '-'}</td>
              <td>${student.social_science !== null ? student.social_science : '-'}</td>
            `;
            tbody.appendChild(tr);
          });
          
          // Also update the student dropdowns
          updateStudentDropdowns(students);
        })
        .catch(error => {
          console.error('Error loading students:', error);
          showError('Failed to load students');
        });
    }
    
    // Save a new student
    function saveStudent() {
      const name = document.getElementById('name').value.trim();
      const studentClass = document.getElementById('cls').value.trim();
      
      if (!name) {
        showError('Name is required');
        return;
      }
      
      if (!studentClass) {
        showError('Class is required');
        return;
      }
      
      const studentData = {
        student_name: name,
        student_class: studentClass,
        section: document.getElementById('sec').value.trim(),
        gender: document.getElementById('gen').value,
        tamil: document.getElementById('tamil').value || 0,
        english: document.getElementById('english').value || 0,
        maths: document.getElementById('maths').value || 0,
        science: document.getElementById('science').value || 0,
        social_science: document.getElementById('ss').value || 0
      };
      
      fetch(`${API_BASE_URL}/students`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(studentData)
      })
      .then(response => {
        if (!response.ok) {
          return response.text().then(text => { throw new Error(text) });
        }
        return response.text();
      })
      .then(() => {
        // Clear the form
        document.querySelectorAll('#students input').forEach(input => {
          if (input.type !== 'button' && input.type !== 'submit') {
            input.value = '';
          }
        });
        
        // Reload the student list
        loadStudents();
        
        // Show success message
        alert('Student saved successfully!');
      })
      .catch(error => {
        console.error('Error saving student:', error);
        showError('Failed to save student: ' + error.message);
      });
    }
    
    // Update student dropdowns in attendance section
    function updateStudentDropdowns(students) {
      const studentSelect = document.getElementById('studentSelect');
      const filterStudent = document.getElementById('filterStudent');
      
      // Clear existing options except the first one
      while (studentSelect.options.length > 1) studentSelect.remove(1);
      while (filterStudent.options.length > 1) filterStudent.remove(1);
      
      if (!students || students.length === 0) return;
      
      students.forEach(student => {
        const option = document.createElement('option');
        option.value = student.student_id;
        option.textContent = `${student.student_name} (Class: ${student.student_class}${student.section ? `-${student.section}` : ''})`;
        
        // Clone the option for the filter dropdown
        const filterOption = option.cloneNode(true);
        
        studentSelect.appendChild(option);
        filterStudent.appendChild(filterOption);
      });
    }
    
    // ====================
    // ATTENDANCE FUNCTIONS
    // ====================
    
    // Load students for attendance dropdown
    function loadStudentsForAttendance() {
      fetch(`${API_BASE_URL}/students`)
        .then(res => res.json())
        .then(students => {
          updateStudentDropdowns(students);
        })
        .catch(error => {
          console.error('Error loading students for attendance:', error);
          showError('Failed to load students for attendance');
        });
    }
    
    // Save attendance
    function saveAttendance() {
      const studentId = document.getElementById('studentSelect').value;
      const date = document.getElementById('attendanceDate').value;
      const status = document.getElementById('attendanceStatus').value;
      
      if (!studentId || !date || !status) {
        showError('Please fill in all required fields');
        return;
      }
      
      fetch(`${API_BASE_URL}/attendance`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          student_id: studentId,
          date: date,
          status: status
        })
      })
      .then(response => response.json())
      .then(data => {
        // Clear the form
        document.getElementById('attendanceStatus').value = '';
        
        // Reload the attendance list
        loadAttendance();
        
        // Show success message
        alert('Attendance saved successfully!');
      })
      .catch(error => {
        console.error('Error saving attendance:', error);
        showError('Failed to save attendance: ' + (error.message || 'Unknown error'));
      });
    }
    
    // Load attendance records
    function loadAttendance() {
      const studentId = document.getElementById('filterStudent').value;
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      
      let url = `${API_BASE_URL}/attendance?`;
      const params = [];
      
      if (studentId) params.push(`student_id=${studentId}`);
      if (startDate) params.push(`start_date=${startDate}`);
      if (endDate) params.push(`end_date=${endDate}`);
      
      url += params.join('&');
      
      fetch(url)
        .then(response => response.json())
        .then(records => {
          const tbody = document.getElementById('attendanceTableBody');
          tbody.innerHTML = '';
          
          if (!records || records.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No attendance records found</td></tr>';
            return;
          }
          
          records.forEach(record => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${formatDate(record.date)}</td>
              <td>${record.student_name || 'Unknown'}</td>
              <td>${record.student_class || ''}${record.section ? `-${record.section}` : ''}</td>
              <td class="status-${record.status.toLowerCase()}">${record.status}</td>
            `;
            tbody.appendChild(tr);
          });
        })
        .catch(error => {
          console.error('Error loading attendance:', error);
          showError('Failed to load attendance records');
        });
    }
    
    // ====================
    // EXAM SCHEDULE FUNCTIONS
    // ====================
    
    // Save exam schedule
    function saveExam() {
      const examName = document.getElementById('examName').value.trim();
      const subject = document.getElementById('subject').value.trim();
      const examDate = document.getElementById('examDate').value;
      const examTime = document.getElementById('examTime').value;
      
      if (!examName || !subject || !examDate || !examTime) {
        showError('Please fill in all required fields');
        return;
      }
      
      fetch(`${API_BASE_URL}/exams`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          exam_name: examName,
          subject: subject,
          exam_date: examDate,
          exam_time: examTime
        })
      })
      .then(response => response.json())
      .then(data => {
        // Clear the form
        document.getElementById('examName').value = '';
        document.getElementById('subject').value = '';
        document.getElementById('examDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('examTime').value = '09:00';
        
        // Reload the exam list
        loadExams();
        
        // Show success message
        alert('Exam schedule saved successfully!');
      })
      .catch(error => {
        console.error('Error saving exam schedule:', error);
        showError('Failed to save exam schedule: ' + (error.message || 'Unknown error'));
      });
    }
    
    // Load exam schedules
    function loadExams() {
      const startDate = document.getElementById('examStartDate').value;
      const endDate = document.getElementById('examEndDate').value;
      
      let url = `${API_BASE_URL}/exams?`;
      const params = [];
      
      if (startDate) params.push(`start_date=${startDate}`);
      if (endDate) params.push(`end_date=${endDate}`);
      
      url += params.join('&');
      
      fetch(url)
        .then(response => response.json())
        .then(exams => {
          const tbody = document.getElementById('examTableBody');
          tbody.innerHTML = '';
          
          if (!exams || exams.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No exam schedules found</td></tr>';
            return;
          }
          
          exams.forEach(exam => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${exam.exam_name || '-'}</td>
              <td>${exam.subject || '-'}</td>
              <td>${formatDate(exam.exam_date)}</td>
              <td>${formatTime(exam.exam_time)}</td>
            `;
            tbody.appendChild(tr);
          });
        })
        .catch(error => {
          console.error('Error loading exam schedules:', error);
          showError('Failed to load exam schedules');
        });
    }
    
    // Utility function to show error messages
    function showError(message) {
      alert('Error: ' + message);
    }

  </script>
</body>
</html>